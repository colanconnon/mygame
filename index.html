<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>My First Game</title>
    <script type="text/javascript" src="js/simpleGame.js"></script>
    <script>
        alert("USE ARROW KEYS TO MOVE FORWARD, HIT AS MANY asteroids AS POSSIBLE IN 50 SECONDS");
        var scene;
        var ship;
        var asteroids;
        var score;
        var scoreDiv;
        var livesDiv;
        var timer;
        var eTime;
        var test;
        var laser;
        var lasers;
        var laserTimer;
        var NUMASTEROIDS = 5;
        var MAXTIME = 1000;
        var NUMLASERS = 15;
        var currentLaser = 0;
        var delay = .1;
        var NUMLIVES = 5;
        var laserSoundMP3;
        var explosionSoundMP3;
        var gameOverMP3;

        function init() {
            scoreDiv = document.getElementById("scoreDiv");
            livesDiv = document.getElementById("livesDiv");

            updateLives();
            scene = new Scene();
            scene.setBG("black");
            scene.setSize(1400,750);
            score = 0;
            makeLasers();
            ship = new Ship();
            setupAsteroids();
            scene.start();
            timer = new Timer();
            laserTimer = new Timer();
            laserSoundMP3 = new Sound("laser.mp3");
            explosionSoundMP3 = new Sound("explosion.mp3");
            gameOverMP3 = new Sound("gameover.mp3");
        }
        function update()
        {
            scene.clear();
            checkTime();
            ship.checkKeys();
            ship.checkDrag();
            ship.update();

            updateLasers();
            for (i = 0; i < NUMASTEROIDS; i++) {
                for (j = 0; j< NUMLASERS; j++){
                    checkCollisions(i,j);

                }
                asteroids[i].update();

               
            }
            
            
        }
        function setupAsteroids() {
            asteroids = new Array(NUMASTEROIDS);
            for (i = 0; i < NUMASTEROIDS; i++){
                asteroids[i] = new Asteroid();
            }
        }
        function checkCollisions(asteroidNum,laserNum) {
            if(ship.collidesWith(asteroids[asteroidNum])){

                NUMLIVES--;
                updateLives();
                if(NUMLIVES == 0)
                {
                    scene.stop();
                }
                gameOverMP3.play();

                asteroids[asteroidNum].reset();
            }
            if(lasers[laserNum].collidesWith(asteroids[asteroidNum]))
            {
                asteroids[asteroidNum].reset();
                explosionSoundMP3.play();
                lasers[laserNum].hide();

                score += 5;
                updateScore();

            }
        }
        function updateScore() {
            //update the scoreboard
            scoreDiv.innerHTML = "Score: " + score + ". Time: " + eTime;
        }
        function updateLives()
        {
            livesDiv.innerHTML = "Lives: " + NUMLIVES;
        }
        function checkTime() {
            eTime = timer.getElapsedTime();
            if (eTime > MAXTIME) {
                scene.stop();
                document.getElementById("reset").style.visibility = 'visible';
            } // end if
            updateScore();

        }
        function Asteroid()
        {
            tAsteroid = new Sprite(scene, "./images/asteroid.png", 60, 60);
            tAsteroid.setSpeed(5);
            tAsteroid.setAngle((Math.random() * 90) - 45);
            tAsteroid.reset = function () {
                //set new random position
                newX = Math.random() * this.cWidth;
                newY = Math.random() * this.cHeight;
                this.setPosition(newX, newY);
            }
            tAsteroid.reset();
            return tAsteroid;

        }
        function Ship() {
            tShip = new Sprite(scene, "./images/shuttle2_0.png", 50, 50);
            tShip.maxSpeed = 15;
            tShip.minSpeed = -1;
            tShip.setSpeed(0);
            tShip.setAngle(0);
            tShip.checkKeys = function () {
                
                if (keysDown[K_LEFT]) {
                    this.changeImgAngleBy(-5);
                } // end if
                if (keysDown[K_RIGHT]) {
                    this.changeImgAngleBy(5);
                } // end if
                if (keysDown[K_UP]) {
                    this.addVector(this.getImgAngle(), 3);
                    if (this.speed > this.maxSpeed) {
                        this.setSpeed(this.maxSpeed);
                    } // end if
                } // end if
                if (keysDown[K_DOWN]) {
                    this.addVector(this.getImgAngle(), -.5);
                    if (this.speed < this.minSpeed) {
                        this.setSpeed(this.minSpeed);
                    } // end if
                } // end if
                if (keysDown[K_SPACE]){
                    laserElapsedTime = laserTimer.getElapsedTime();
                    if(laserElapsedTime > delay)
                    {

                        currentLaser++;
                        if(currentLaser >= NUMLASERS)
                        {
                            currentLaser = 0;
                        }
                        lasers[currentLaser].fire();
                        laserSoundMP3.play();
                        laserTimer.reset();
                    }
                }
            }
            tShip.checkDrag = function () {           
                    speed = this.getSpeed();
                    speed *= .95;
                    this.setSpeed(speed);
            }
            return tShip;
        }
        function Laser()
        {
            var tLaser = new Sprite(scene, "./images/lasers.png", 30, 20);
            tLaser.hide();

            tLaser.fire = function()
            {
                this.show();
                this.setSpeed(45);
                this.setBoundAction(BOUNCE);
                this.setPosition(ship.x,ship.y);
                this.setAngle(ship.getImgAngle());

            }
            return tLaser;
        }
        function makeLasers()
        {
            lasers = new Array(NUMLASERS);
            for(i = 0; i < NUMLASERS; i++){
                lasers[i] = new Laser();
            }

        }
        function updateLasers()
        {
            for(i = 0; i < NUMLASERS; i++){
                lasers[i].update();
            }
        }
        function restart() {
            document.location.href = "";
        } // end restart
    </script>
</head>
<body onload="init()">
    <div id="scoreDiv">s</div>
    <div id="livesDiv"></div>
    <button type="button" id="reset" style=" position: absolute; top:0px; left:180px; visibility:hidden;" onclick="restart()">Reset Game</button>

</body>
</html>
